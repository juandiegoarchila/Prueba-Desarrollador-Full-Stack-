{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/juand/OneDrive/Escritorio/Grupo Merpes/prueba-fullstack-ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject } from 'rxjs';\nimport { LocalAuthRepository } from '../repositories/local/local-auth.repository';\nimport { FirebaseAuthRepository } from '../repositories/firebase/firebase-auth.repository';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor(injector) {\n      this.injector = injector;\n      this.currentUserSubject = new BehaviorSubject(null);\n      this.currentUser$ = this.currentUserSubject.asObservable();\n      // Nuevo: Flag para saber si Firebase ya respondió al menos una vez\n      this.authStateReadySubject = new BehaviorSubject(false);\n      this.authStateReady$ = this.authStateReadySubject.asObservable();\n      if (environment.useFirebase) {\n        this.repository = this.injector.get(FirebaseAuthRepository);\n      } else {\n        this.repository = this.injector.get(LocalAuthRepository);\n      }\n      this.checkSession();\n    }\n    checkSession() {\n      this.repository.getCurrentUser().subscribe(user => {\n        this.currentUserSubject.next(user);\n        this.authStateReadySubject.next(true); // Ya sabemos el estado (sea user o null)\n      });\n    }\n    login(email, pass) {\n      const obs = this.repository.login(email, pass);\n      obs.subscribe(user => this.currentUserSubject.next(user));\n      return obs;\n    }\n    register(name, email, pass) {\n      const obs = this.repository.register(name, email, pass);\n      obs.subscribe(user => this.currentUserSubject.next(user));\n      return obs;\n    }\n    logout() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.repository.logout();\n        _this.currentUserSubject.next(null);\n      })();\n    }\n    resetPassword(email) {\n      return this.repository.resetPassword(email);\n    }\n    isAuthenticated() {\n      return this.currentUserSubject.value !== null;\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(t) {\n        return new (t || AuthService)(i0.ɵɵinject(i0.Injector));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}