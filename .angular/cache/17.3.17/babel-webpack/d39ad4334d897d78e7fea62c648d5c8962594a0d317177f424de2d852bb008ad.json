{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/juand/OneDrive/Escritorio/Grupo Merpes/prueba-fullstack-ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ConfirmationModalComponent } from '../../shared/components/confirmation-modal/confirmation-modal.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/cart.service\";\nimport * as i2 from \"../../core/services/auth.service\";\nimport * as i3 from \"../../core/services/order.service\";\nimport * as i4 from \"@ionic/angular\";\nimport * as i5 from \"../../core/services/notification.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../shared/components/app-header/app-header.component\";\nimport * as i8 from \"../../shared/components/empty-state/empty-state.component\";\nfunction CartPage_ion_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 6);\n    i0.ɵɵlistener(\"click\", function CartPage_ion_button_1_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.confirmClear());\n    });\n    i0.ɵɵelement(1, \"ion-icon\", 7);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CartPage_div_4_div_1_ion_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\", 12)(1, \"div\", 13)(2, \"div\", 14);\n    i0.ɵɵelement(3, \"ion-img\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 16)(5, \"h3\", 17);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 18);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 19)(11, \"div\", 20)(12, \"ion-button\", 21);\n    i0.ɵɵlistener(\"click\", function CartPage_div_4_div_1_ion_card_1_Template_ion_button_click_12_listener() {\n      const item_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.updateQty(item_r4.product.id, item_r4.quantity - 1));\n    });\n    i0.ɵɵelement(13, \"ion-icon\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"span\", 23);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"ion-button\", 21);\n    i0.ɵɵlistener(\"click\", function CartPage_div_4_div_1_ion_card_1_Template_ion_button_click_16_listener() {\n      const item_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.updateQty(item_r4.product.id, item_r4.quantity + 1));\n    });\n    i0.ɵɵelement(17, \"ion-icon\", 24);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"ion-button\", 25);\n    i0.ɵɵlistener(\"click\", function CartPage_div_4_div_1_ion_card_1_Template_ion_button_click_18_listener() {\n      const item_r4 = i0.ɵɵrestoreView(_r3).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeItem(item_r4.product.id));\n    });\n    i0.ɵɵelement(19, \"ion-icon\", 7);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(20, \"div\", 26)(21, \"span\", 27);\n    i0.ɵɵtext(22, \"Subtotal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"span\", 28);\n    i0.ɵɵtext(24);\n    i0.ɵɵpipe(25, \"currency\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r4 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", item_r4.product.imageUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r4.product.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(9, 5, item_r4.product.price, \"COP\", \"symbol\", \"1.0-0\"));\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(item_r4.quantity);\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(25, 10, item_r4.total, \"COP\", \"symbol\", \"1.0-0\"));\n  }\n}\nfunction CartPage_div_4_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵtemplate(1, CartPage_div_4_div_1_ion_card_1_Template, 26, 15, \"ion-card\", 11);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const items_r5 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", items_r5);\n  }\n}\nfunction CartPage_div_4_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"app-empty-state\", 30);\n    i0.ɵɵlistener(\"action\", function CartPage_div_4_ng_template_2_Template_app_empty_state_action_1_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.goToCatalog());\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CartPage_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵtemplate(1, CartPage_div_4_div_1_Template, 2, 1, \"div\", 9)(2, CartPage_div_4_ng_template_2_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const items_r5 = ctx.ngIf;\n    const emptyCart_r7 = i0.ɵɵreference(3);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", items_r5.length > 0)(\"ngIfElse\", emptyCart_r7);\n  }\n}\nfunction CartPage_ion_footer_6_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 33)(1, \"div\", 34)(2, \"span\");\n    i0.ɵɵtext(3, \"Subtotal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 34)(8, \"span\");\n    i0.ɵɵtext(9, \"Env\\u00EDo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"span\", 35);\n    i0.ɵɵtext(11, \"Gratis\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(12, \"div\", 36);\n    i0.ɵɵelementStart(13, \"div\", 37)(14, \"span\", 38);\n    i0.ɵɵtext(15, \"Total a pagar:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"span\", 39);\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"ion-button\", 40);\n    i0.ɵɵlistener(\"click\", function CartPage_ion_footer_6_div_1_Template_ion_button_click_19_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.checkout());\n    });\n    i0.ɵɵtext(20, \" Confirmar Compra \");\n    i0.ɵɵelement(21, \"ion-icon\", 41);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const total_r9 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(6, 2, total_r9, \"COP\", \"symbol\", \"1.0-0\"));\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(18, 7, total_r9, \"COP\", \"symbol\", \"1.0-0\"));\n  }\n}\nfunction CartPage_ion_footer_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-footer\", 31);\n    i0.ɵɵtemplate(1, CartPage_ion_footer_6_div_1_Template, 22, 12, \"div\", 32);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const total_r9 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", total_r9 > 0);\n  }\n}\nexport let CartPage = /*#__PURE__*/(() => {\n  class CartPage {\n    constructor(cartService, auth, orderService, nav, modalCtrl, notify) {\n      this.cartService = cartService;\n      this.auth = auth;\n      this.orderService = orderService;\n      this.nav = nav;\n      this.modalCtrl = modalCtrl;\n      this.notify = notify;\n      this.cartItems$ = this.cartService.cart$;\n      this.total$ = this.cartService.total$;\n    }\n    updateQty(productId, qty) {\n      if (qty <= 0) {\n        this.removeItem(productId);\n      } else {\n        this.cartService.updateQuantity(productId, qty);\n      }\n    }\n    removeItem(id) {\n      this.cartService.removeFromCart(id);\n      this.notify.showWarning('Producto eliminado');\n    }\n    confirmClear() {\n      // Implementar modal de confirmación aquí si se desea\n      this.cartService.clearCart();\n      this.notify.showInfo('Carrito vaciado');\n    }\n    goToCatalog() {\n      this.nav.navigateBack('/catalog');\n    }\n    checkout() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (!_this.auth.isAuthenticated()) {\n          _this.notify.showInfo('Debes iniciar sesión para finalizar tu compra');\n          _this.nav.navigateForward('/login');\n          return;\n        }\n        const modal = yield _this.modalCtrl.create({\n          component: ConfirmationModalComponent,\n          componentProps: {\n            title: 'Confirmar Pedido',\n            message: '¿Estás seguro de que deseas procesar la compra?'\n          },\n          cssClass: 'small-modal'\n        });\n        yield modal.present();\n        const {\n          data\n        } = yield modal.onWillDismiss();\n        if (data && data.confirmed) {\n          _this.processOrder();\n        }\n      })();\n    }\n    processOrder() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const items = _this2.cartService.getCurrentValue();\n        const total = items.reduce((acc, i) => acc + i.total, 0);\n        const order = {\n          id: Date.now().toString(),\n          items: items,\n          total: total,\n          date: new Date(),\n          status: 'pending',\n          userId: '1'\n        };\n        try {\n          // Guardar primero localmente (Estrategia offline-first)\n          yield _this2.orderService.createOrder(order);\n          _this2.cartService.clearCart();\n          _this2.notify.showSuccess('¡Pedido realizado con éxito!');\n          _this2.nav.navigateRoot('/confirm');\n        } catch (e) {\n          _this2.notify.showError('Hubo un problema al crear el pedido. Inténtalo de nuevo.');\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function CartPage_Factory(t) {\n        return new (t || CartPage)(i0.ɵɵdirectiveInject(i1.CartService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.OrderService), i0.ɵɵdirectiveInject(i4.NavController), i0.ɵɵdirectiveInject(i4.ModalController), i0.ɵɵdirectiveInject(i5.NotificationService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CartPage,\n        selectors: [[\"app-cart\"]],\n        decls: 8,\n        vars: 10,\n        consts: [[\"emptyCart\", \"\"], [\"title\", \"Tu Carrito\", 3, \"backButton\"], [\"color\", \"danger\", \"fill\", \"clear\", 3, \"click\", 4, \"ngIf\"], [\"color\", \"light\"], [\"class\", \"cart-container\", 4, \"ngIf\"], [\"class\", \"ion-no-border\", 4, \"ngIf\"], [\"color\", \"danger\", \"fill\", \"clear\", 3, \"click\"], [\"name\", \"trash-outline\", \"slot\", \"icon-only\"], [1, \"cart-container\"], [\"class\", \"items-list\", 4, \"ngIf\", \"ngIfElse\"], [1, \"items-list\"], [\"class\", \"cart-card mode-ios\", 4, \"ngFor\", \"ngForOf\"], [1, \"cart-card\", \"mode-ios\"], [1, \"card-body\"], [1, \"thumb-wrapper\"], [3, \"src\"], [1, \"info-col\"], [1, \"product-name\"], [1, \"unit-price\"], [1, \"controls-row\"], [1, \"stepper\"], [\"size\", \"small\", \"fill\", \"outline\", 1, \"step-btn\", 3, \"click\"], [\"name\", \"remove\", \"slot\", \"icon-only\"], [1, \"qty-val\"], [\"name\", \"add\", \"slot\", \"icon-only\"], [\"fill\", \"clear\", \"color\", \"medium\", 1, \"delete-btn\", 3, \"click\"], [1, \"card-footer-item\"], [1, \"subtotal-label\"], [1, \"subtotal-val\"], [1, \"empty-container\"], [\"title\", \"Tu carrito est\\u00E1 vac\\u00EDo\", \"description\", \"Explora nuestro cat\\u00E1logo y agrega los mejores productos.\", \"icon\", \"cart-outline\", \"actionText\", \"Ir a comprar\", 3, \"action\"], [1, \"ion-no-border\"], [\"class\", \"cart-summary\", 4, \"ngIf\"], [1, \"cart-summary\"], [1, \"summary-row\"], [1, \"free-shipping\"], [1, \"divider\"], [1, \"total-row\"], [1, \"total-label\"], [1, \"total-amount\"], [\"expand\", \"block\", \"shape\", \"round\", \"color\", \"primary\", 1, \"checkout-btn\", 3, \"click\"], [\"name\", \"chevron-forward\", \"slot\", \"end\"]],\n        template: function CartPage_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"app-header\", 1);\n            i0.ɵɵtemplate(1, CartPage_ion_button_1_Template, 2, 0, \"ion-button\", 2);\n            i0.ɵɵpipe(2, \"async\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"ion-content\", 3);\n            i0.ɵɵtemplate(4, CartPage_div_4_Template, 4, 2, \"div\", 4);\n            i0.ɵɵpipe(5, \"async\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(6, CartPage_ion_footer_6_Template, 2, 1, \"ion-footer\", 5);\n            i0.ɵɵpipe(7, \"async\");\n          }\n          if (rf & 2) {\n            let tmp_1_0;\n            i0.ɵɵproperty(\"backButton\", true);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", (tmp_1_0 = i0.ɵɵpipeBind1(2, 4, ctx.cartItems$)) == null ? null : tmp_1_0.length);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(5, 6, ctx.cartItems$));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(7, 8, ctx.total$));\n          }\n        },\n        dependencies: [i6.NgForOf, i6.NgIf, i4.IonButton, i4.IonCard, i4.IonContent, i4.IonFooter, i4.IonIcon, i4.IonImg, i7.AppHeaderComponent, i8.EmptyStateComponent, i6.AsyncPipe, i6.CurrencyPipe],\n        styles: [\"ion-content[_ngcontent-%COMP%]{--background: #f4f5f8}.cart-container[_ngcontent-%COMP%]{padding:16px 16px 80px;max-width:800px;margin:0 auto}.items-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.cart-card[_ngcontent-%COMP%]{margin:0;border-radius:12px;box-shadow:0 4px 12px #0000000d;background:#fff}.cart-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:12px;display:flex;gap:12px;align-items:flex-start}.cart-card[_ngcontent-%COMP%]   .thumb-wrapper[_ngcontent-%COMP%]{width:90px;height:90px;border-radius:8px;overflow:hidden;background:#f9f9f9;padding:4px;flex-shrink:0}.cart-card[_ngcontent-%COMP%]   .thumb-wrapper[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between;min-height:90px}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:var(--ion-color-dark);margin:0 0 4px;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .unit-price[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium);margin:0 0 10px}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .controls-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .controls-row[_ngcontent-%COMP%]   .stepper[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f3f3f3;border-radius:8px;height:32px}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .controls-row[_ngcontent-%COMP%]   .stepper[_ngcontent-%COMP%]   .step-btn[_ngcontent-%COMP%]{margin:0;--padding-start: 8px;--padding-end: 8px;--color: var(--ion-color-dark);--border-color: transparent;height:32px}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .controls-row[_ngcontent-%COMP%]   .stepper[_ngcontent-%COMP%]   .step-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.cart-card[_ngcontent-%COMP%]   .info-col[_ngcontent-%COMP%]   .controls-row[_ngcontent-%COMP%]   .stepper[_ngcontent-%COMP%]   .qty-val[_ngcontent-%COMP%]{font-weight:600;font-size:14px;min-width:24px;text-align:center}.cart-card[_ngcontent-%COMP%]   .card-footer-item[_ngcontent-%COMP%]{border-top:1px solid #f0f0f0;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;background:#fafafa}.cart-card[_ngcontent-%COMP%]   .card-footer-item[_ngcontent-%COMP%]   .subtotal-label[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium)}.cart-card[_ngcontent-%COMP%]   .card-footer-item[_ngcontent-%COMP%]   .subtotal-val[_ngcontent-%COMP%]{font-size:14px;font-weight:700;color:var(--ion-color-primary)}ion-footer[_ngcontent-%COMP%]{background:#fff;box-shadow:0 -4px 16px #0000000f;z-index:10}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px;color:var(--ion-color-medium-shade)}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]   .free-shipping[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:600}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{height:1px;background:#eee;margin:12px 0}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:16px}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:var(--ion-color-dark)}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:24px;font-weight:800;color:var(--ion-color-dark)}ion-footer[_ngcontent-%COMP%]   .cart-summary[_ngcontent-%COMP%]   .checkout-btn[_ngcontent-%COMP%]{--box-shadow: 0 4px 12px rgba(var(--ion-color-primary-rgb), .3);font-weight:600;font-size:16px;height:48px}.empty-container[_ngcontent-%COMP%]{height:80vh;display:flex;align-items:center;justify-content:center}\"]\n      });\n    }\n  }\n  return CartPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}