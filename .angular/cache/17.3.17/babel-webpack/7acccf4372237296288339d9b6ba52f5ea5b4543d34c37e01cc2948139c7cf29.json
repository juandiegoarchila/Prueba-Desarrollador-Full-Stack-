{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/juand/OneDrive/Escritorio/Grupo Merpes/prueba-fullstack-ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { firstValueFrom } from 'rxjs';\nimport { ConfirmationModalComponent } from '../../shared/components/confirmation-modal/confirmation-modal.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/cart.service\";\nimport * as i2 from \"../../core/services/auth.service\";\nimport * as i3 from \"../../core/services/order.service\";\nimport * as i4 from \"@ionic/angular\";\nimport * as i5 from \"../../core/services/notification.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../shared/components/app-header/app-header.component\";\nimport * as i8 from \"../../shared/components/empty-state/empty-state.component\";\nfunction CartPage_div_5_div_1_ion_item_sliding_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item-sliding\", 10)(1, \"ion-item\", 11)(2, \"ion-thumbnail\", 12);\n    i0.ɵɵelement(3, \"img\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-label\", 14)(5, \"div\", 15)(6, \"h3\", 16);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"span\", 17);\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 18)(12, \"ion-button\", 19);\n    i0.ɵɵlistener(\"click\", function CartPage_div_5_div_1_ion_item_sliding_2_Template_ion_button_click_12_listener() {\n      const item_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r2.updateQty(item_r2.product.id, item_r2.quantity - 1));\n    });\n    i0.ɵɵelement(13, \"ion-icon\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"span\", 21);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"ion-button\", 19);\n    i0.ɵɵlistener(\"click\", function CartPage_div_5_div_1_ion_item_sliding_2_Template_ion_button_click_16_listener() {\n      const item_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r2.updateQty(item_r2.product.id, item_r2.quantity + 1));\n    });\n    i0.ɵɵelement(17, \"ion-icon\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"ion-button\", 23);\n    i0.ɵɵlistener(\"click\", function CartPage_div_5_div_1_ion_item_sliding_2_Template_ion_button_click_18_listener() {\n      const item_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r2.removeItem(item_r2.product.id));\n    });\n    i0.ɵɵelement(19, \"ion-icon\", 24);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(20, \"ion-item-options\", 25)(21, \"ion-item-option\", 26);\n    i0.ɵɵlistener(\"click\", function CartPage_div_5_div_1_ion_item_sliding_2_Template_ion_item_option_click_21_listener() {\n      const item_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r2.removeItem(item_r2.product.id));\n    });\n    i0.ɵɵelement(22, \"ion-icon\", 27);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", item_r2.product.imageUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(item_r2.product.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(10, 4, item_r2.total, \"COP\", \"symbol\", \"1.0-0\"));\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(item_r2.quantity);\n  }\n}\nfunction CartPage_div_5_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"ion-list\", 8);\n    i0.ɵɵtemplate(2, CartPage_div_5_div_1_ion_item_sliding_2_Template, 23, 9, \"ion-item-sliding\", 9);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const items_r4 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", items_r4);\n  }\n}\nfunction CartPage_div_5_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-empty-state\", 28);\n    i0.ɵɵlistener(\"action\", function CartPage_div_5_ng_template_2_Template_app_empty_state_action_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.goToCatalog());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CartPage_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, CartPage_div_5_div_1_Template, 3, 1, \"div\", 7)(2, CartPage_div_5_ng_template_2_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const items_r4 = ctx.ngIf;\n    const emptyCart_r6 = i0.ɵɵreference(3);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", items_r4.length > 0)(\"ngIfElse\", emptyCart_r6);\n  }\n}\nfunction CartPage_ion_footer_7_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32)(2, \"div\", 33)(3, \"span\");\n    i0.ɵɵtext(4, \"Subtotal (Base)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 33)(9, \"span\");\n    i0.ɵɵtext(10, \"IVA (19%)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"span\");\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"div\", 33)(15, \"span\");\n    i0.ɵɵtext(16, \"Env\\u00EDo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"span\", 34);\n    i0.ɵɵtext(18, \"Gratis\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(19, \"div\", 35);\n    i0.ɵɵelementStart(20, \"div\", 36)(21, \"span\", 37);\n    i0.ɵɵtext(22, \"Total a pagar:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"span\", 38);\n    i0.ɵɵtext(24);\n    i0.ɵɵpipe(25, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(26, \"ion-button\", 39);\n    i0.ɵɵlistener(\"click\", function CartPage_ion_footer_7_div_1_Template_ion_button_click_26_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.checkout());\n    });\n    i0.ɵɵtext(27, \" FINALIZAR COMPRA \");\n    i0.ɵɵelement(28, \"ion-icon\", 40);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const total_r8 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(7, 3, total_r8 / 1.19, \"COP\", \"symbol\", \"1.0-0\"));\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(13, 8, total_r8 - total_r8 / 1.19, \"COP\", \"symbol\", \"1.0-0\"));\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(25, 13, total_r8, \"COP\", \"symbol\", \"1.0-0\"));\n  }\n}\nfunction CartPage_ion_footer_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-footer\", 29);\n    i0.ɵɵtemplate(1, CartPage_ion_footer_7_div_1_Template, 29, 18, \"div\", 30);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const total_r8 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", total_r8 > 0);\n  }\n}\nexport let CartPage = /*#__PURE__*/(() => {\n  class CartPage {\n    constructor(cartService, auth, orderService, nav, modalCtrl, loadingCtrl, notify) {\n      this.cartService = cartService;\n      this.auth = auth;\n      this.orderService = orderService;\n      this.nav = nav;\n      this.modalCtrl = modalCtrl;\n      this.loadingCtrl = loadingCtrl;\n      this.notify = notify;\n      this.cartItems$ = this.cartService.cart$;\n      this.total$ = this.cartService.total$;\n    }\n    updateQty(productId, qty) {\n      if (qty <= 0) {\n        this.removeItem(productId);\n      } else {\n        this.cartService.updateQuantity(productId, qty);\n      }\n    }\n    removeItem(id) {\n      this.cartService.removeFromCart(id);\n      this.notify.showWarning('Producto eliminado');\n    }\n    confirmClear() {\n      // Implementar modal de confirmación aquí si se desea\n      this.cartService.clearCart();\n      this.notify.showInfo('Carrito vaciado');\n    }\n    goToCatalog() {\n      this.nav.navigateBack('/catalog');\n    }\n    checkout() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (!_this.auth.isAuthenticated()) {\n          _this.notify.showInfo('Debes iniciar sesión para finalizar tu compra');\n          _this.nav.navigateForward('/login');\n          return;\n        }\n        const items = _this.cartService.getCurrentValue();\n        const total = items.reduce((acc, i) => acc + i.total, 0);\n        const modal = yield _this.modalCtrl.create({\n          component: ConfirmationModalComponent,\n          componentProps: {\n            title: 'Confirmar Pedido',\n            message: '¿Estás seguro de que deseas procesar la compra?',\n            total: total\n          },\n          cssClass: 'small-modal'\n        });\n        yield modal.present();\n        const {\n          data\n        } = yield modal.onWillDismiss();\n        if (data && data.confirmed) {\n          _this.processOrder();\n        }\n      })();\n    }\n    processOrder() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const loading = yield _this2.loadingCtrl.create({\n          message: 'Procesando tu compra...',\n          spinner: 'crescent'\n        });\n        yield loading.present();\n        try {\n          const items = _this2.cartService.getCurrentValue();\n          const total = items.reduce((acc, i) => acc + i.total, 0);\n          const order = {\n            id: Date.now().toString(),\n            items: items,\n            total: total,\n            date: new Date(),\n            status: 'pending',\n            userId: '1'\n          };\n          // Guardar primero localmente (Estrategia offline-first)\n          yield firstValueFrom(_this2.orderService.createOrder(order));\n          _this2.cartService.clearCart();\n          yield loading.dismiss();\n          // Modal already dismissed in checkout() via onWillDismiss logic if confirm was clicked\n          _this2.notify.showSuccess('¡Pedido realizado con éxito!');\n          _this2.nav.navigateRoot('/catalog');\n        } catch (e) {\n          yield loading.dismiss();\n          console.error('Error procesando orden:', e);\n          _this2.notify.showError('Error al crear el pedido: ' + (e.message || e));\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function CartPage_Factory(t) {\n        return new (t || CartPage)(i0.ɵɵdirectiveInject(i1.CartService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.OrderService), i0.ɵɵdirectiveInject(i4.NavController), i0.ɵɵdirectiveInject(i4.ModalController), i0.ɵɵdirectiveInject(i4.LoadingController), i0.ɵɵdirectiveInject(i5.NotificationService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CartPage,\n        selectors: [[\"app-cart\"]],\n        decls: 9,\n        vars: 7,\n        consts: [[\"emptyCart\", \"\"], [\"title\", \"Tu Carrito\", 3, \"backButton\"], [\"fill\", \"clear\", \"color\", \"light\", 3, \"click\"], [\"name\", \"arrow-back-circle-outline\", \"slot\", \"start\"], [\"color\", \"light\", 1, \"ion-padding\"], [4, \"ngIf\"], [\"class\", \"ion-no-border shadow-card\", 4, \"ngIf\"], [4, \"ngIf\", \"ngIfElse\"], [1, \"cart-list\", \"ion-no-padding\"], [\"class\", \"cart-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"cart-item\"], [\"lines\", \"none\", 1, \"item-inner\"], [\"slot\", \"start\", 1, \"rounded-thumb\"], [3, \"src\"], [1, \"ion-text-wrap\"], [1, \"header-flex\"], [1, \"text-bold\", \"text-dark\", \"product-name\"], [1, \"text-bold\", \"text-dark\", \"item-price\"], [1, \"stepper\"], [\"size\", \"small\", \"fill\", \"outline\", \"color\", \"medium\", 1, \"stepper-btn\", 3, \"click\"], [\"name\", \"remove\", \"slot\", \"icon-only\"], [1, \"qty-label\"], [\"name\", \"add\", \"slot\", \"icon-only\"], [\"size\", \"small\", \"fill\", \"clear\", \"color\", \"danger\", 1, \"trash-btn\", 3, \"click\"], [\"name\", \"trash-outline\", \"slot\", \"icon-only\"], [\"side\", \"end\"], [\"color\", \"danger\", 3, \"click\"], [\"name\", \"trash\", \"slot\", \"icon-only\"], [\"title\", \"Carrito vac\\u00EDo\", \"description\", \"Aqu\\u00ED ver\\u00E1s los productos que selecciones.\", \"icon\", \"cart-outline\", \"actionText\", \"Ir al cat\\u00E1logo\", 3, \"action\"], [1, \"ion-no-border\", \"shadow-card\"], [\"class\", \"footer-container\", 4, \"ngIf\"], [1, \"footer-container\"], [1, \"order-summary\"], [1, \"summary-row\"], [1, \"free-badge\"], [1, \"divider\"], [1, \"total-row\"], [1, \"text-medium\", \"text-muted\"], [1, \"text-bold\", \"text-large\"], [\"expand\", \"block\", \"shape\", \"round\", \"color\", \"success\", 1, \"checkout-btn\", 3, \"click\"], [\"name\", \"arrow-forward\", \"slot\", \"end\"]],\n        template: function CartPage_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"app-header\", 1)(1, \"ion-button\", 2);\n            i0.ɵɵlistener(\"click\", function CartPage_Template_ion_button_click_1_listener() {\n              return ctx.goToCatalog();\n            });\n            i0.ɵɵelement(2, \"ion-icon\", 3);\n            i0.ɵɵtext(3, \" Volver \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(4, \"ion-content\", 4);\n            i0.ɵɵtemplate(5, CartPage_div_5_Template, 4, 2, \"div\", 5);\n            i0.ɵɵpipe(6, \"async\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(7, CartPage_ion_footer_7_Template, 2, 1, \"ion-footer\", 6);\n            i0.ɵɵpipe(8, \"async\");\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"backButton\", true);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(6, 3, ctx.cartItems$));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(8, 5, ctx.total$));\n          }\n        },\n        dependencies: [i6.NgForOf, i6.NgIf, i4.IonButton, i4.IonContent, i4.IonFooter, i4.IonIcon, i4.IonItem, i4.IonItemOption, i4.IonItemOptions, i4.IonItemSliding, i4.IonLabel, i4.IonList, i4.IonThumbnail, i7.AppHeaderComponent, i8.EmptyStateComponent, i6.AsyncPipe, i6.CurrencyPipe],\n        styles: [\".cart-list[_ngcontent-%COMP%]{background:transparent}.cart-item[_ngcontent-%COMP%]{margin-bottom:15px;border-radius:12px;background:#fff;box-shadow:0 4px 12px #0000000d;overflow:hidden}.item-inner[_ngcontent-%COMP%]{--background: white;--inner-padding-end: 10px}.rounded-thumb[_ngcontent-%COMP%]{--border-radius: 10px}.text-dark[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}.text-bold[_ngcontent-%COMP%]{font-weight:800}.header-flex[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:8px}.product-name[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.25;flex:1 1 140px}.item-price[_ngcontent-%COMP%]{font-size:15px;color:var(--ion-color-tertiary);white-space:nowrap}.stepper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:8px;gap:5px}.qty-label[_ngcontent-%COMP%]{font-weight:600;min-width:20px;text-align:center;font-size:14px}.stepper-btn[_ngcontent-%COMP%]{height:28px;--padding-start: 4px;--padding-end: 4px;min-width:32px;margin:0}.trash-btn[_ngcontent-%COMP%]{height:28px;width:30px;--padding-start: 0;--padding-end: 0;margin-left:5px}.total-column[_ngcontent-%COMP%]{display:none}.footer-container[_ngcontent-%COMP%]{background:#fff;padding:12px 16px 20px;box-shadow:0 -5px 20px #0000000d;border-radius:20px 20px 0 0}.order-summary[_ngcontent-%COMP%]{margin-bottom:5px}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:2px;font-size:13px;color:var(--ion-color-medium)}.free-badge[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700}.divider[_ngcontent-%COMP%]{height:1px;background:#f0f0f0;margin:8px 0 12px}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.text-large[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--ion-color-tertiary)}.checkout-btn[_ngcontent-%COMP%]{height:45px;--box-shadow: 0 8px 20px rgba(0, 184, 148, .3);font-weight:700;letter-spacing:.5px}\"]\n      });\n    }\n  }\n  return CartPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}