{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/juand/OneDrive/Escritorio/Grupo Merpes/prueba-fullstack-ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../storage/storage.service\";\nexport let CartService = /*#__PURE__*/(() => {\n  class CartService {\n    constructor(storage) {\n      this.storage = storage;\n      this.cartItems = new BehaviorSubject([]);\n      this.cart$ = this.cartItems.asObservable();\n      this.total$ = this.cart$.pipe(map(items => items.reduce((acc, item) => acc + item.product.price * item.quantity, 0)));\n      this.itemCount$ = this.cart$.pipe(map(items => items.reduce((acc, item) => acc + item.quantity, 0)));\n      this.loadCart();\n    }\n    loadCart() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const items = yield _this.storage.get('cart');\n        if (items) {\n          _this.cartItems.next(items);\n        }\n      })();\n    }\n    saveCart(items) {\n      this.cartItems.next(items);\n      this.storage.set('cart', items);\n    }\n    addToCart(product, quantity = 1) {\n      const currentItems = [...this.cartItems.value];\n      const existingItemIndex = currentItems.findIndex(i => i.product.id === product.id);\n      if (existingItemIndex > -1) {\n        const item = currentItems[existingItemIndex];\n        item.quantity += quantity;\n        item.total = item.quantity * item.product.price;\n        currentItems[existingItemIndex] = item;\n      } else {\n        currentItems.push({\n          product,\n          quantity,\n          total: product.price * quantity\n        });\n      }\n      this.saveCart(currentItems);\n    }\n    updateQuantity(productId, quantity) {\n      const currentItems = [...this.cartItems.value];\n      const index = currentItems.findIndex(i => i.product.id === productId);\n      if (index > -1) {\n        if (quantity > 0) {\n          currentItems[index].quantity = quantity;\n          currentItems[index].total = quantity * currentItems[index].product.price;\n          this.saveCart(currentItems);\n        } else {\n          this.removeFromCart(productId);\n        }\n      }\n    }\n    removeFromCart(productId) {\n      const currentItems = this.cartItems.value.filter(i => i.product.id !== productId);\n      this.saveCart(currentItems);\n    }\n    clearCart() {\n      this.saveCart([]);\n    }\n    getCurrentValue() {\n      return this.cartItems.value;\n    }\n    static {\n      this.ɵfac = function CartService_Factory(t) {\n        return new (t || CartService)(i0.ɵɵinject(i1.StorageService));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: CartService,\n        factory: CartService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return CartService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}