"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3283],{6042:(E,C,o)=>{o.d(C,{m:()=>P});var m=o(467),s=o(4412),x=o(6354),h=o(4438),_=o(1658);let P=(()=>{class t{constructor(l){this.storage=l,this.cartItems=new s.t([]),this.cart$=this.cartItems.asObservable(),this.total$=this.cart$.pipe((0,x.T)(a=>a.reduce((c,p)=>c+p.product.price*p.quantity,0))),this.itemCount$=this.cart$.pipe((0,x.T)(a=>a.reduce((c,p)=>c+p.quantity,0))),this.loadCart()}loadCart(){var l=this;return(0,m.A)(function*(){const a=yield l.storage.get("cart");a&&Array.isArray(a)&&l.cartItems.next(a)})()}saveCart(l){this.cartItems.next(l),this.storage.set("cart",l)}addToCart(l,a=1){const c=[...this.cartItems.value],p=c.findIndex(g=>g.product.id===l.id);if(p>-1){const g=c[p];g.quantity+=a,g.total=g.quantity*g.product.price,c[p]=g}else c.push({product:l,quantity:a,total:l.price*a});this.saveCart(c)}updateQuantity(l,a){const c=[...this.cartItems.value],p=c.findIndex(g=>g.product.id===l);p>-1&&(a>0?(c[p].quantity=a,c[p].total=a*c[p].product.price,this.saveCart(c)):this.removeFromCart(l))}removeFromCart(l){const a=this.cartItems.value.filter(c=>c.product.id!==l);this.saveCart(a)}clearCart(){this.saveCart([])}getCurrentValue(){return this.cartItems.value}static{this.\u0275fac=function(a){return new(a||t)(h.KVO(_.n))}}static{this.\u0275prov=h.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})()},5567:(E,C,o)=>{o.d(C,{J:()=>h});var m=o(467),s=o(4438),x=o(8974);let h=(()=>{class _{constructor(t){this.toastController=t}showSuccess(t){var u=this;return(0,m.A)(function*(){yield u.presentToast(t,"success","checkmark-circle-outline")})()}showError(t){var u=this;return(0,m.A)(function*(){yield u.presentToast(t,"danger","alert-circle-outline")})()}showInfo(t){var u=this;return(0,m.A)(function*(){yield u.presentToast(t,"primary","information-circle-outline")})()}showWarning(t){var u=this;return(0,m.A)(function*(){yield u.presentToast(t,"warning","warning-outline")})()}presentToast(t,u,l){var a=this;return(0,m.A)(function*(){try{yield(yield a.toastController.create({message:t,icon:l,duration:3e3,color:u,position:"bottom",buttons:[{icon:"close",role:"cancel",handler:()=>{}}],cssClass:"custom-toast"})).present()}catch(c){console.error("Error al mostrar notificaci\xf3n:",c)}})()}static{this.\u0275fac=function(u){return new(u||_)(s.KVO(x.K_))}}static{this.\u0275prov=s.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},3283:(E,C,o)=>{o.r(C),o.d(C,{CartPageModule:()=>G});var m=o(177),s=o(8974),x=o(9539),h=o(467),_=o(1413),P=o(6977),t=o(4438);function u(e,f){if(1&e&&(t.j41(0,"div",9)(1,"div",10)(2,"span"),t.EFF(3,"Subtotal (Base)"),t.k0s(),t.j41(4,"span"),t.EFF(5),t.nI1(6,"currency"),t.k0s()(),t.j41(7,"div",10)(8,"span"),t.EFF(9,"IVA (19%)"),t.k0s(),t.j41(10,"span"),t.EFF(11),t.nI1(12,"currency"),t.k0s()(),t.j41(13,"div",10)(14,"span"),t.EFF(15,"Env\xedo"),t.k0s(),t.j41(16,"span",11),t.EFF(17,"Gratis"),t.k0s()(),t.nrm(18,"div",12),t.j41(19,"div",13)(20,"span"),t.EFF(21,"Total a pagar:"),t.k0s(),t.j41(22,"span",14),t.EFF(23),t.nI1(24,"currency"),t.k0s()()()),2&e){const n=t.XpG();t.R7$(5),t.JRh(t.ii3(6,3,n.total/1.19,"COP","symbol","1.0-0")),t.R7$(6),t.JRh(t.ii3(12,8,n.total-n.total/1.19,"COP","symbol","1.0-0")),t.R7$(12),t.JRh(t.ii3(24,13,n.total,"COP","symbol","1.0-0"))}}let l=(()=>{class e{constructor(n){this.modalCtrl=n,this.title="Confirmaci\xf3n",this.message="\xbfEst\xe1s seguro de realizar esta acci\xf3n?",this.total=0}cancel(){this.modalCtrl.dismiss({confirmed:!1},"cancel")}confirm(){this.modalCtrl.dismiss({confirmed:!0},"confirm")}static{this.\u0275fac=function(r){return new(r||e)(t.rXU(s.W3))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-confirmation-modal"]],inputs:{title:"title",message:"message",total:"total"},decls:13,vars:3,consts:[[1,"modal-wrapper","ion-padding"],[1,"icon-header","ion-text-center"],["name","help-circle-outline","color","primary"],[1,"text-bold","ion-text-center"],[1,"text-medium","text-muted","ion-text-center"],["class","order-summary-box",4,"ngIf"],[1,"actions"],["expand","block","fill","outline","color","medium",1,"action-btn",3,"click"],["expand","block","color","primary",1,"action-btn",3,"click"],[1,"order-summary-box"],[1,"summary-line"],[1,"free-text"],[1,"separator"],[1,"total-line"],[1,"total-val"]],template:function(r,i){1&r&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"ion-icon",2),t.k0s(),t.j41(3,"h2",3),t.EFF(4),t.k0s(),t.j41(5,"p",4),t.EFF(6),t.k0s(),t.DNE(7,u,25,18,"div",5),t.j41(8,"div",6)(9,"ion-button",7),t.bIt("click",function(){return i.cancel()}),t.EFF(10," Cancelar "),t.k0s(),t.j41(11,"ion-button",8),t.bIt("click",function(){return i.confirm()}),t.EFF(12," Confirmar "),t.k0s()()()),2&r&&(t.R7$(4),t.JRh(i.title),t.R7$(2),t.JRh(i.message),t.R7$(),t.Y8G("ngIf",i.total>0))},dependencies:[m.bT,s.Jm,s.iq,m.oe],styles:[".modal-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding-top:30px}.icon-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:60px;margin-bottom:10px}h2[_ngcontent-%COMP%]{margin:0 0 10px;color:var(--ion-color-tertiary)}p[_ngcontent-%COMP%]{margin:0 0 20px;line-height:1.5}.order-summary-box[_ngcontent-%COMP%]{width:100%;background:#f8f9fa;padding:15px;border-radius:12px;margin-bottom:25px}.summary-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:5px;font-size:13px;color:#6c757d}.free-text[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700}.separator[_ngcontent-%COMP%]{height:1px;background:#dee2e6;margin:8px 0}.total-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;color:var(--ion-color-dark);font-size:15px}.actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:15px;width:100%}.action-btn[_ngcontent-%COMP%]{margin:0;--box-shadow: none;font-weight:600}"]})}}return e})();var a=o(5312),c=o(6042),p=o(1935),g=o(5182),I=o(4517),O=o(5567),k=o(8245),j=o(5577);function M(e,f){if(1&e){const n=t.RV6();t.j41(0,"ion-item-sliding",10)(1,"ion-item",11)(2,"ion-thumbnail",12),t.nrm(3,"img",13),t.k0s(),t.j41(4,"ion-label",14)(5,"div",15)(6,"h3",16),t.EFF(7),t.k0s(),t.j41(8,"span",17),t.EFF(9),t.nI1(10,"currency"),t.k0s()(),t.j41(11,"div",18)(12,"ion-button",19),t.bIt("click",function(){const i=t.eBV(n).$implicit,d=t.XpG(3);return t.Njj(d.updateQty(i.product.id,i.quantity-1))}),t.nrm(13,"ion-icon",20),t.k0s(),t.j41(14,"span",21),t.EFF(15),t.k0s(),t.j41(16,"ion-button",19),t.bIt("click",function(){const i=t.eBV(n).$implicit,d=t.XpG(3);return t.Njj(d.updateQty(i.product.id,i.quantity+1))}),t.nrm(17,"ion-icon",22),t.k0s(),t.j41(18,"ion-button",23),t.bIt("click",function(){const i=t.eBV(n).$implicit,d=t.XpG(3);return t.Njj(d.removeItem(i.product.id))}),t.nrm(19,"ion-icon",24),t.k0s()()()(),t.j41(20,"ion-item-options",25)(21,"ion-item-option",26),t.bIt("click",function(){const i=t.eBV(n).$implicit,d=t.XpG(3);return t.Njj(d.removeItem(i.product.id))}),t.nrm(22,"ion-icon",27),t.k0s()()()}if(2&e){const n=f.$implicit;t.R7$(3),t.Y8G("src",n.product.imageUrl,t.B4B),t.R7$(4),t.JRh(n.product.name),t.R7$(2),t.JRh(t.ii3(10,4,n.total,"COP","symbol","1.0-0")),t.R7$(6),t.JRh(n.quantity)}}function F(e,f){if(1&e&&(t.j41(0,"div")(1,"ion-list",8),t.DNE(2,M,23,9,"ion-item-sliding",9),t.k0s()()),2&e){const n=t.XpG().ngIf;t.R7$(2),t.Y8G("ngForOf",n)}}function T(e,f){if(1&e){const n=t.RV6();t.j41(0,"app-empty-state",28),t.bIt("action",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.goToCatalog())}),t.k0s()}}function R(e,f){if(1&e&&(t.j41(0,"div"),t.DNE(1,F,3,1,"div",7)(2,T,1,0,"ng-template",null,0,t.C5r),t.k0s()),2&e){const n=f.ngIf,r=t.sdS(3);t.R7$(),t.Y8G("ngIf",n.length>0)("ngIfElse",r)}}function w(e,f){if(1&e){const n=t.RV6();t.j41(0,"div",31)(1,"div",32)(2,"div",33)(3,"span"),t.EFF(4,"Subtotal (Base)"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.nI1(7,"currency"),t.k0s()(),t.j41(8,"div",33)(9,"span"),t.EFF(10,"IVA (19%)"),t.k0s(),t.j41(11,"span"),t.EFF(12),t.nI1(13,"currency"),t.k0s()(),t.j41(14,"div",33)(15,"span"),t.EFF(16,"Env\xedo"),t.k0s(),t.j41(17,"span",34),t.EFF(18,"Gratis"),t.k0s()()(),t.nrm(19,"div",35),t.j41(20,"div",36)(21,"span",37),t.EFF(22,"Total a pagar:"),t.k0s(),t.j41(23,"span",38),t.EFF(24),t.nI1(25,"currency"),t.k0s()(),t.j41(26,"ion-button",39),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2);return t.Njj(i.checkout())}),t.EFF(27," FINALIZAR COMPRA "),t.nrm(28,"ion-icon",40),t.k0s()()}if(2&e){const n=t.XpG().ngIf;t.R7$(6),t.JRh(t.ii3(7,3,n/1.19,"COP","symbol","1.0-0")),t.R7$(6),t.JRh(t.ii3(13,8,n-n/1.19,"COP","symbol","1.0-0")),t.R7$(12),t.JRh(t.ii3(25,13,n,"COP","symbol","1.0-0"))}}function $(e,f){if(1&e&&(t.j41(0,"ion-footer",29),t.DNE(1,w,29,18,"div",30),t.k0s()),2&e){const n=f.ngIf;t.R7$(),t.Y8G("ngIf",n>0)}}let D=(()=>{class e{constructor(n,r,i,d,y,v,b){this.cartService=n,this.auth=r,this.orderService=i,this.nav=d,this.modalCtrl=y,this.notify=v,this.loadingCtrl=b,this.cartItems$=this.cartService.cart$,this.total$=this.cartService.total$,this.destroy$=new _.B}updateQty(n,r){r<=0?this.removeItem(n):this.cartService.updateQuantity(n,r)}removeItem(n){this.cartService.removeFromCart(n),this.notify.showWarning("Producto eliminado")}confirmClear(){this.cartService.clearCart(),this.notify.showInfo("Carrito vaciado")}goToCatalog(){this.nav.navigateBack("/catalog")}checkout(){var n=this;return(0,h.A)(function*(){if(!n.auth.isAuthenticated())return n.notify.showInfo("Debes iniciar sesi\xf3n para finalizar tu compra"),void n.nav.navigateForward("/login");const i=n.cartService.getCurrentValue().reduce((v,b)=>v+b.total,0),d=yield n.modalCtrl.create({component:l,componentProps:{title:"Confirmar Pedido",message:"\xbfEst\xe1s seguro de que deseas procesar la compra?",total:i},cssClass:"small-modal"});yield d.present();const{data:y}=yield d.onWillDismiss();y&&y.confirmed&&n.processOrder()})()}processOrder(){var n=this;return(0,h.A)(function*(){const r=yield n.loadingCtrl.create({message:"Procesando tu pedido...",duration:5e3});yield r.present();const i=n.cartService.getCurrentValue(),d=i.reduce((v,b)=>v+b.total,0),y={id:Date.now().toString(),items:i,total:d,date:new Date,status:"pending",userId:n.auth.currentUserValue?.uid||"1"};n.orderService.createOrder(y).pipe((0,P.Q)(n.destroy$)).subscribe({next:()=>{r.dismiss(),n.cartService.clearCart(),n.notify.showSuccess("\xa1Pedido realizado con \xe9xito!"),n.nav.navigateRoot("/confirm")},error:v=>{r.dismiss(),a.c.production||console.error("Order creation failed:",v),n.notify.showError("Hubo un problema al crear el pedido.")}})})()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(r){return new(r||e)(t.rXU(c.m),t.rXU(p.u),t.rXU(g.Q),t.rXU(I.q9),t.rXU(s.W3),t.rXU(O.J),t.rXU(s.Xi))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-cart"]],decls:9,vars:7,consts:[["emptyCart",""],["title","Tu Carrito",3,"backButton"],["fill","clear","color","light",3,"click"],["name","arrow-back-circle-outline","slot","start"],["color","light",1,"ion-padding"],[4,"ngIf"],["class","ion-no-border shadow-card",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"cart-list","ion-no-padding"],["class","cart-item",4,"ngFor","ngForOf"],[1,"cart-item"],["lines","none",1,"item-inner"],["slot","start",1,"rounded-thumb"],[3,"src"],[1,"ion-text-wrap"],[1,"header-flex"],[1,"text-bold","text-dark","product-name"],[1,"text-bold","text-dark","item-price"],[1,"stepper"],["size","small","fill","outline","color","medium",1,"stepper-btn",3,"click"],["name","remove","slot","icon-only"],[1,"qty-label"],["name","add","slot","icon-only"],["size","small","fill","clear","color","danger",1,"trash-btn",3,"click"],["name","trash-outline","slot","icon-only"],["side","end"],["color","danger",3,"click"],["name","trash","slot","icon-only"],["title","Carrito vac\xedo","description","Aqu\xed ver\xe1s los productos que selecciones.","icon","cart-outline","actionText","Ir al cat\xe1logo",3,"action"],[1,"ion-no-border","shadow-card"],["class","footer-container",4,"ngIf"],[1,"footer-container"],[1,"order-summary"],[1,"summary-row"],[1,"free-badge"],[1,"divider"],[1,"total-row"],[1,"text-medium","text-muted"],[1,"text-bold","text-large"],["expand","block","shape","round","color","success",1,"checkout-btn",3,"click"],["name","arrow-forward","slot","end"]],template:function(r,i){1&r&&(t.j41(0,"app-header",1)(1,"ion-button",2),t.bIt("click",function(){return i.goToCatalog()}),t.nrm(2,"ion-icon",3),t.EFF(3," Volver "),t.k0s()(),t.j41(4,"ion-content",4),t.DNE(5,R,4,2,"div",5),t.nI1(6,"async"),t.k0s(),t.DNE(7,$,2,1,"ion-footer",6),t.nI1(8,"async")),2&r&&(t.Y8G("backButton",!0),t.R7$(5),t.Y8G("ngIf",t.bMT(6,3,i.cartItems$)),t.R7$(2),t.Y8G("ngIf",t.bMT(8,5,i.total$)))},dependencies:[m.Sq,m.bT,s.Jm,s.W9,s.M0,s.iq,s.uz,s.LU,s.CE,s.A7,s.he,s.nf,s.Zx,k.y,j.o,m.Jj,m.oe],styles:[".cart-list[_ngcontent-%COMP%]{background:transparent}.cart-item[_ngcontent-%COMP%]{margin-bottom:15px;border-radius:12px;background:#fff;box-shadow:0 4px 12px #0000000d;overflow:hidden}.item-inner[_ngcontent-%COMP%]{--background: white;--inner-padding-end: 10px}.rounded-thumb[_ngcontent-%COMP%]{--border-radius: 10px}.text-dark[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}.text-bold[_ngcontent-%COMP%]{font-weight:800}.header-flex[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:8px}.product-name[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.25;flex:1 1 140px}.item-price[_ngcontent-%COMP%]{font-size:15px;color:var(--ion-color-tertiary);white-space:nowrap}.stepper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:8px;gap:5px}.qty-label[_ngcontent-%COMP%]{font-weight:600;min-width:20px;text-align:center;font-size:14px}.stepper-btn[_ngcontent-%COMP%]{height:28px;--padding-start: 4px;--padding-end: 4px;min-width:32px;margin:0}.trash-btn[_ngcontent-%COMP%]{height:28px;width:30px;--padding-start: 0;--padding-end: 0;margin-left:5px}.total-column[_ngcontent-%COMP%]{display:none}.footer-container[_ngcontent-%COMP%]{background:#fff;padding:12px 16px 20px;box-shadow:0 -5px 20px #0000000d;border-radius:20px 20px 0 0}.order-summary[_ngcontent-%COMP%]{margin-bottom:5px}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:2px;font-size:13px;color:var(--ion-color-medium)}.free-badge[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700}.divider[_ngcontent-%COMP%]{height:1px;background:#f0f0f0;margin:8px 0 12px}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.text-large[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--ion-color-tertiary)}.checkout-btn[_ngcontent-%COMP%]{height:45px;--box-shadow: 0 8px 20px rgba(0, 184, 148, .3);font-weight:700;letter-spacing:.5px}"]})}}return e})();var A=o(3887);let G=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[m.MD,s.bv,A.G,x.iI.forChild([{path:"",component:D}])]})}}return e})()}}]);